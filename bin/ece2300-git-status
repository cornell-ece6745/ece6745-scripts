#!/bin/bash
#=========================================================================
# ece2300-git-status [options]
#=========================================================================
#
#  -h  Display this message
#  -v  Verbose mode
#
# Produces a status output somewhat similar to subversion's status
# command. It first shows the status of all tracked files which are
# modified, deleted, or added, then shows the status of all files in the
# index (marked with an asterisk), and finally shows which files and
# directories are untracked. Here is an example output:
#
#   D colors.txt
#   M animals.txt
#   M fruit.txt
#  *M fruit.txt
#   ? vegetables.txt
#
# This shows that a file named 'colors.txt' has been deleted from the
# working directory, but this deletion has not been added to the index
# yet ('colors.txt' is not listed with an asterisk). The file
# 'animals.txt' has been modified buy not added to the index yet. Note
# that the file named 'fruit.txt' has been modified and added to the
# index, but it has been modified _since_ it was added to the index as
# indicated by its double listing. The file name 'vegetables.txt' is
# currently untracked.
#
# The possible status codes are the same as for git diff --name-status:
#
#  - A : addition of a file
#  - C : copy of a file into a new one
#  - D : deletion of a file
#  - M : modification of the contents or mode of a file
#  - R : renaming of a file
#  - T : change in the type of the file
#  - U : file is unmerged (you must complete the merge before commit)
#
# Author : Christopher Batten
# Date   : August 18, 2009

set -e

#-------------------------------------------------------------------------
# Command line parsing
#-------------------------------------------------------------------------

function usage
{
  echo ""
  sed -n '3p' $0 | sed -e 's/#//'
  sed -n '5,/^$/p' $0 | sed -e 's/#//'
  exit 1
}

verbose=no
while getopts "hvr" OPTION; do
  case $OPTION in
    v)   verbose=yes ;;
    h|?) usage ;;
  esac
done

#-------------------------------------------------------------------------
# Main
#-------------------------------------------------------------------------

# Determine branch and relationship to remote
git_branch=`git status | grep -e "# On branch" | sed 's/^# On branch //'`
git_diverge=`git status | grep -e "# Your branch" | sed 's/^# Your branch //'`
echo "-- ${git_branch} ${git_diverge}"

# Report on files in working directory
git diff --name-status | sed 's/^\(.\)[[:space:]]*/ \1 /'
git diff --staged --name-status | sed 's/^\(.\)[[:space:]]*/*\1 /'
git ls-files --directory --exclude-standard --others -t | sed 's/^/ /'

exit 0

